process.shell = ['/bin/bash']

profiles {

    // TODO: add conda

    docker {
        docker.enabled         = true
        docker.userEmulation   = true
        fixOwnership           = true
        runOptions             = "-u \$(id -u):\$(id -g)"
        singularity.enabled    = false
        shifter.enabled        = false
        registry               = "snads"
    }

    singularity {
        singularity.enabled    = true
        singularity.autoMounts = true
        docker.enabled         = false
        shifter.enabled        = false
        conda.enabled          = false
        params.enable_conda    = false
    }

    sge {
        process {
            executor = 'sge'
            penv     = 'smp'
            queue    = 'all.q'
        }
    }

}

def trace_timestamp = new java.util.Date().format('yyyy-MM-dd HH:mm:ss')

// Default parameters (can be overwritten by command line inputs)
params.inpath = new File("${launchDir}").getCanonicalPath()
params.outpath = new File("${launchDir}").getCanonicalPath()
params.logpath = new File("${params.outpath}/.log").getCanonicalPath()
params.exclude = 'none'
params.targetChunkSize = false
params.targetNChunks = false
params.backgrChunkSize = false
params.backgrNChunks = false
params.max_bg_bind_rate = 0.00000667
params.min_fg_bind_rate = 0.00001
params.min_bg_bind_dist = 30000
params.max_fg_bind_dist = 36000
params.set_find_workers = 1
params.max_sets_search = -1
params.min_kmer_size = 5
params.max_kmer_size = 12
params.min_tm = 15
params.max_tm = 45
params.find_sets_min_size = 2
params.find_sets_max_size = 7
params.n_top_primers = 200
params.n_top_sets = -1
params.run_find_sets = true
params.help = false
params.version = false

timeline {
    enabled = true
    file    = "${params.outpath}/timeline.${trace_timestamp}.html"
}

report {
    enabled = true
    file    = "${params.outpath}/report.${trace_timestamp}.html"
}

trace {
    enabled = true
    fields  = 'task_id,name,status,exit,realtime,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar'
    file    = "${params.outpath}/trace.${trace_timestamp}.txt"
}

dag {
    enabled = true
    file    = "${params.outpath}/pipeline_dag.${trace_timestamp}.svg"
}

manifest {
    author = 'Sarah Nadeau'
    description = 'Generate candidate primer set for selective whole-genome amplification'
    mainScript = 'main.nf'
    nextflowVersion = '>=20.01.0'
    version = '1.0.0'
}
